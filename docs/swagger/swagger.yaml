basePath: /api/v1
definitions:
  internal_api.AddOwnerRequest:
    properties:
      email:
        type: string
    type: object
  internal_api.CreateLinkRequest:
    properties:
      description:
        type: string
      slug:
        type: string
      tags:
        items:
          type: string
        type: array
      title:
        type: string
      url:
        type: string
    type: object
  internal_api.CreateTokenRequest:
    properties:
      expires_at:
        type: string
      name:
        type: string
    type: object
  internal_api.ErrorResponse:
    properties:
      code:
        type: string
      error:
        type: string
    type: object
  internal_api.LinkListResponse:
    properties:
      links:
        items:
          $ref: '#/definitions/internal_api.LinkResponse'
        type: array
      next_cursor:
        type: string
    type: object
  internal_api.LinkResponse:
    properties:
      created_at:
        type: string
      description:
        type: string
      id:
        type: string
      owners:
        items:
          $ref: '#/definitions/internal_api.OwnerResponse'
        type: array
      slug:
        type: string
      tags:
        items:
          type: string
        type: array
      title:
        type: string
      updated_at:
        type: string
      url:
        type: string
    type: object
  internal_api.OwnerResponse:
    properties:
      email:
        type: string
      id:
        type: string
      is_primary:
        type: boolean
    type: object
  internal_api.TagListResponse:
    properties:
      next_cursor:
        type: string
      tags:
        items:
          $ref: '#/definitions/internal_api.TagResponse'
        type: array
    type: object
  internal_api.TagResponse:
    properties:
      link_count:
        type: integer
      name:
        type: string
      slug:
        type: string
    type: object
  internal_api.TokenCreatedResponse:
    properties:
      created_at:
        type: string
      expires_at:
        type: string
      id:
        type: string
      last_used_at:
        type: string
      name:
        type: string
      token:
        type: string
    type: object
  internal_api.TokenListResponse:
    properties:
      tokens:
        items:
          $ref: '#/definitions/internal_api.TokenResponse'
        type: array
    type: object
  internal_api.TokenResponse:
    properties:
      created_at:
        type: string
      expires_at:
        type: string
      id:
        type: string
      last_used_at:
        type: string
      name:
        type: string
    type: object
  internal_api.UpdateLinkRequest:
    properties:
      description:
        type: string
      tags:
        items:
          type: string
        type: array
      title:
        type: string
      url:
        type: string
    type: object
  internal_api.UpdateRoleRequest:
    properties:
      role:
        type: string
    type: object
  internal_api.UserListResponse:
    properties:
      next_cursor:
        type: string
      users:
        items:
          $ref: '#/definitions/internal_api.UserResponse'
        type: array
    type: object
  internal_api.UserResponse:
    properties:
      created_at:
        type: string
      display_name:
        type: string
      email:
        type: string
      id:
        type: string
      role:
        type: string
    type: object
info:
  contact: {}
  description: Self-hosted go-links service. Authenticate with a Personal Access Token.
  title: joe-links API
  version: "1.0"
paths:
  /admin/links:
    get:
      consumes:
      - application/json
      description: Returns all links system-wide with owners and tags. Requires admin
        role.
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/internal_api.LinkListResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
      security:
      - BearerToken: []
      summary: List all links (admin)
      tags:
      - Admin
  /admin/users:
    get:
      consumes:
      - application/json
      description: Returns all users in the system. Requires admin role.
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/internal_api.UserListResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
      security:
      - BearerToken: []
      summary: List all users (admin)
      tags:
      - Admin
  /admin/users/{id}/role:
    put:
      consumes:
      - application/json
      description: 'Changes a user''s role. Valid values: "user", "admin". Requires
        admin role.'
      parameters:
      - description: User ID
        in: path
        name: id
        required: true
        type: string
      - description: New role
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/internal_api.UpdateRoleRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/internal_api.UserResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
      security:
      - BearerToken: []
      summary: Update user role (admin)
      tags:
      - Admin
  /links:
    get:
      consumes:
      - application/json
      description: Returns links owned by the caller. Admins see all links.
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/internal_api.LinkListResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
      security:
      - BearerToken: []
      summary: List links
      tags:
      - Links
    post:
      consumes:
      - application/json
      description: Creates a new short link. The caller becomes the primary owner.
      parameters:
      - description: Link to create
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/internal_api.CreateLinkRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/internal_api.LinkResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
      security:
      - BearerToken: []
      summary: Create a link
      tags:
      - Links
  /links/{id}:
    delete:
      consumes:
      - application/json
      description: Deletes a link by ID. Only owners and admins may delete.
      parameters:
      - description: Link ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
      security:
      - BearerToken: []
      summary: Delete a link
      tags:
      - Links
    get:
      consumes:
      - application/json
      description: Returns a single link by ID. Only owners and admins may access.
      parameters:
      - description: Link ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/internal_api.LinkResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
      security:
      - BearerToken: []
      summary: Get a link
      tags:
      - Links
    put:
      consumes:
      - application/json
      description: Updates url, title, description, and tags. Slug is immutable and
        ignored.
      parameters:
      - description: Link ID
        in: path
        name: id
        required: true
        type: string
      - description: Fields to update
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/internal_api.UpdateLinkRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/internal_api.LinkResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
      security:
      - BearerToken: []
      summary: Update a link
      tags:
      - Links
  /links/{id}/owners:
    get:
      consumes:
      - application/json
      description: Returns all owners of a link. Only owners and admins may access.
      parameters:
      - description: Link ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/internal_api.OwnerResponse'
            type: array
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
      security:
      - BearerToken: []
      summary: List link owners
      tags:
      - Owners
    post:
      consumes:
      - application/json
      description: Adds a co-owner to a link by email address. Only owners and admins
        may add.
      parameters:
      - description: Link ID
        in: path
        name: id
        required: true
        type: string
      - description: Co-owner to add
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/internal_api.AddOwnerRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/internal_api.OwnerResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
      security:
      - BearerToken: []
      summary: Add a co-owner
      tags:
      - Owners
  /links/{id}/owners/{uid}:
    delete:
      consumes:
      - application/json
      description: Removes a co-owner from a link. The primary owner cannot be removed.
      parameters:
      - description: Link ID
        in: path
        name: id
        required: true
        type: string
      - description: User ID of the owner to remove
        in: path
        name: uid
        required: true
        type: string
      produces:
      - application/json
      responses:
        "204":
          description: No Content
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
      security:
      - BearerToken: []
      summary: Remove a co-owner
      tags:
      - Owners
  /tags:
    get:
      consumes:
      - application/json
      description: Returns all tags that have at least one associated link.
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/internal_api.TagListResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
      security:
      - BearerToken: []
      summary: List tags
      tags:
      - Tags
  /tags/{slug}/links:
    get:
      consumes:
      - application/json
      description: Returns links with the given tag. Admins see all; non-admins see
        only owned links.
      parameters:
      - description: Tag slug
        in: path
        name: slug
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/internal_api.LinkListResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
      security:
      - BearerToken: []
      summary: List links by tag
      tags:
      - Tags
  /tokens:
    get:
      consumes:
      - application/json
      description: Returns all API tokens for the authenticated user. Never includes
        token_hash.
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/internal_api.TokenListResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
      security:
      - BearerToken: []
      summary: List tokens
      tags:
      - Tokens
    post:
      consumes:
      - application/json
      description: Generates a new API token. The plaintext token is returned only
        in this response.
      parameters:
      - description: Token to create
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/internal_api.CreateTokenRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/internal_api.TokenCreatedResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
      security:
      - BearerToken: []
      summary: Create a token
      tags:
      - Tokens
  /tokens/{id}:
    delete:
      consumes:
      - application/json
      description: Soft-deletes an API token. Returns 404 if the token belongs to
        another user.
      parameters:
      - description: Token ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
      security:
      - BearerToken: []
      summary: Revoke a token
      tags:
      - Tokens
  /users/me:
    get:
      consumes:
      - application/json
      description: Returns the authenticated caller's profile.
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/internal_api.UserResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/internal_api.ErrorResponse'
      security:
      - BearerToken: []
      summary: Get current user
      tags:
      - Users
securityDefinitions:
  BearerToken:
    description: 'Type "Bearer" followed by a space and your API token. Example: "Bearer
      jl_xxx"'
    in: header
    name: Authorization
    type: apiKey
swagger: "2.0"
