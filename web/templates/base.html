{{define "base"}}<!DOCTYPE html>
<html lang="en"{{if .Theme}} data-theme="{{.Theme}}"{{end}}>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{block "title" .}}Joe Links{{end}}</title>
    <!-- Governing: SPEC-0003 REQ "System-Preference Default" â€” anti-flash inline script, must precede stylesheets -->
    <script>!function(){var c=document.cookie.match(/theme=(joe-(?:light|dark))/);document.documentElement.dataset.theme=c?c[1]:matchMedia("(prefers-color-scheme:dark)").matches?"joe-dark":"joe-light"}()</script>
    <link rel="stylesheet" href="/static/css/app.css">
    <script src="/static/js/htmx.min.js"></script>
</head>
<body class="min-h-screen bg-base-100"
      hx-on:themeChanged="document.documentElement.setAttribute('data-theme',event.detail.theme);document.getElementById('theme-icon-sun').style.display=event.detail.theme==='joe-dark'?'block':'none';document.getElementById('theme-icon-moon').style.display=event.detail.theme==='joe-dark'?'none':'block'">

{{if .User}}
<!-- Governing: SPEC-0004 REQ "Shared Base Layout" â€” navbar with nav links, conditional Admin, user dropdown -->
<nav class="navbar bg-base-200 shadow-sm px-4">
    <div class="navbar-start">
        <a href="/dashboard" class="btn btn-ghost text-xl font-bold">Joe Links</a>
    </div>
    <div class="navbar-center hidden lg:flex">
        <ul class="menu menu-horizontal px-1">
            <li><a href="/dashboard">Dashboard</a></li>
            <li><a href="/dashboard/tags">Tags</a></li>
            <!-- Governing: SPEC-0013 REQ "Collapsible Admin Sidebar Section" -->
            {{if eq .User.Role "admin"}}
            <li>
                <details{{if .IsAdminPage}} open{{end}}>
                    <summary class="list-none">Admin</summary>
                    <ul class="bg-base-200 rounded-t-none p-2 z-10">
                        <li><a href="/admin">Overview</a></li>
                        <li><a href="/admin/users">Users</a></li>
                    </ul>
                </details>
            </li>
            {{end}}
        </ul>
    </div>
    <div class="navbar-end gap-2">
        <!-- Governing: SPEC-0003 REQ "Theme Toggle Control", SPEC-0013 REQ "Theme Toggle Immediate Visual Feedback" -->
        <button id="theme-toggle" class="btn btn-ghost btn-circle"
                onclick="(function(){var cur=document.documentElement.getAttribute('data-theme');var next=cur==='joe-dark'?'joe-light':'joe-dark';document.documentElement.setAttribute('data-theme',next);document.getElementById('theme-icon-sun').style.display=next==='joe-dark'?'block':'none';document.getElementById('theme-icon-moon').style.display=next==='joe-dark'?'none':'block'})()"
                hx-post="/dashboard/theme"
                hx-vals='js:{theme: document.documentElement.getAttribute("data-theme")}'
                hx-swap="none">
            <span id="theme-icon-sun" style="{{if eq .Theme "joe-dark"}}display:block{{else}}display:none{{end}}">â˜€ï¸</span>
            <span id="theme-icon-moon" style="{{if eq .Theme "joe-dark"}}display:none{{else}}display:block{{end}}">ğŸŒ™</span>
        </button>
        <div class="dropdown dropdown-end">
            <div tabindex="0" role="button" class="btn btn-ghost btn-circle avatar placeholder">
                <div class="bg-neutral text-neutral-content rounded-full w-8">
                    <span class="text-xs">{{slice .User.DisplayName 0 1}}</span>
                </div>
            </div>
            <ul tabindex="0" class="menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-base-100 rounded-box w-52">
                <li><span class="text-sm font-medium">{{.User.DisplayName}}</span></li>
                <!-- Governing: SPEC-0013 REQ "API Tokens Link in User Section" -->
                <li><a href="/dashboard/settings/tokens">API Tokens</a></li>
                <li>
                    <form method="POST" action="/auth/logout">
                        <button type="submit">Sign out</button>
                    </form>
                </li>
            </ul>
        </div>
    </div>
</nav>
{{else}}
<nav class="navbar bg-base-200 shadow-sm px-4">
    <div class="navbar-start">
        <a href="/" class="btn btn-ghost text-xl font-bold">Joe Links</a>
    </div>
    <div class="navbar-end gap-2">
        <!-- Governing: SPEC-0003 REQ "Theme Toggle Control", SPEC-0013 REQ "Theme Toggle Immediate Visual Feedback" -->
        <button id="theme-toggle" class="btn btn-ghost btn-circle"
                onclick="(function(){var cur=document.documentElement.getAttribute('data-theme');var next=cur==='joe-dark'?'joe-light':'joe-dark';document.documentElement.setAttribute('data-theme',next);document.getElementById('theme-icon-sun').style.display=next==='joe-dark'?'block':'none';document.getElementById('theme-icon-moon').style.display=next==='joe-dark'?'none':'block'})()"
                hx-post="/dashboard/theme"
                hx-vals='js:{theme: document.documentElement.getAttribute("data-theme")}'
                hx-swap="none">
            <span id="theme-icon-sun" style="{{if eq .Theme "joe-dark"}}display:block{{else}}display:none{{end}}">â˜€ï¸</span>
            <span id="theme-icon-moon" style="{{if eq .Theme "joe-dark"}}display:none{{else}}display:block{{end}}">ğŸŒ™</span>
        </button>
        <a href="/auth/login" class="btn btn-sm btn-primary">Sign in</a>
    </div>
</nav>
{{end}}

<!-- Governing: SPEC-0004 REQ "Shared Base Layout" â€” toast area for HTMX OOB swaps -->
<div id="toast-area" class="toast toast-top toast-end z-50"></div>

<main class="container mx-auto px-4 py-8 max-w-4xl">
    {{block "content" .}}{{end}}
</main>

<!-- Governing: SPEC-0004 REQ "Shared Base Layout" â€” modal target for HTMX injection -->
<div id="modal"></div>

</body>
</html>
{{end}}
