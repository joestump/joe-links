<!DOCTYPE html>
<html lang="en"{{if .Theme}} data-theme="{{.Theme}}"{{end}}>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{block "title" .}}Joe Links{{end}}</title>
    <!-- Governing: SPEC-0003 REQ "System-Preference Default" ‚Äî anti-flash inline script, must precede stylesheets -->
    <script>(function(){var t=document.cookie.match(/theme=([^;]+)/);var theme=t?decodeURIComponent(t[1]):(window.matchMedia('(prefers-color-scheme: dark)').matches?'joe-dark':'joe-light');if(theme==='joe-light'||theme==='joe-dark'){document.documentElement.setAttribute('data-theme',theme)}})()</script>
    <link rel="stylesheet" href="/static/css/app.css">
    <script src="/static/js/htmx.min.js"></script>
</head>
<body class="min-h-screen bg-base-100"
      hx-on:themeChanged="document.documentElement.setAttribute('data-theme',event.detail.theme);document.getElementById('theme-toggle-icon').textContent=event.detail.theme==='joe-dark'?'‚òÄÔ∏è':'üåô'">

<nav class="navbar bg-base-200 shadow-sm px-4">
    <div class="navbar-start">
        <a href="/dashboard" class="btn btn-ghost text-xl font-bold">
            Joe Links
        </a>
    </div>
    <div class="navbar-end gap-2">
        <!-- Governing: SPEC-0003 REQ "Theme Toggle Control" ‚Äî sun when dark, moon when light -->
        <button id="theme-toggle"
                class="btn btn-ghost btn-circle"
                hx-post="/dashboard/theme"
                hx-vals='js:{theme: document.documentElement.getAttribute("data-theme") === "joe-dark" ? "joe-light" : "joe-dark"}'
                hx-swap="none">
            <span id="theme-toggle-icon">{{if eq .Theme "joe-dark"}}‚òÄÔ∏è{{else}}üåô{{end}}</span>
        </button>
        {{if .User}}
        <span class="text-sm text-base-content/70">{{.User.DisplayName}}</span>
        <form method="POST" action="/auth/logout">
            <button class="btn btn-sm btn-ghost">Sign out</button>
        </form>
        {{else}}
        <a href="/auth/login" class="btn btn-sm btn-primary">Sign in</a>
        {{end}}
    </div>
</nav>

{{if .Flash}}
<div class="toast toast-top toast-end z-50">
    <div class="alert alert-{{.Flash.Type}}">
        <span>{{.Flash.Message}}</span>
    </div>
</div>
{{end}}

<main class="container mx-auto px-4 py-8 max-w-4xl">
    {{block "content" .}}{{end}}
</main>

</body>
</html>
