{{define "token_list"}}
{{if .Flash}}
<div class="alert alert-{{.Flash.Type}} mb-4">
    <span>{{.Flash.Message}}</span>
</div>
{{end}}

{{if .Error}}
<div class="alert alert-error mb-4">
    <span>{{.Error}}</span>
</div>
{{end}}

<!-- Governing: SPEC-0006 REQ "Token Management Web UI" â€” one-time token reveal -->
{{if .NewToken}}
<div class="alert alert-warning mb-6 shadow-lg">
    <div>
        <h3 class="font-bold">Your new API token</h3>
        <p class="text-sm">Copy this token now. You will not be able to see it again.</p>
        <code class="block mt-2 p-3 bg-base-300 rounded text-sm break-all select-all font-mono">{{.NewToken}}</code>
    </div>
</div>
{{end}}

<!-- New Token form -->
<div class="card bg-base-200 mb-6">
    <div class="card-body">
        <h2 class="card-title text-lg">Create a new token</h2>
        <form hx-post="/dashboard/settings/tokens"
              hx-target="#token-content"
              hx-swap="innerHTML"
              class="flex flex-col sm:flex-row gap-3 items-end">
            <div class="form-control flex-1">
                <label class="label"><span class="label-text">Token name</span></label>
                <input type="text" name="name" class="input input-bordered w-full"
                       placeholder="e.g. CI/CD pipeline" required>
            </div>
            <div class="form-control w-full sm:w-48">
                <label class="label"><span class="label-text">Expires in</span></label>
                <select name="expires_in" class="select select-bordered w-full">
                    <option value="">Never</option>
                    <option value="720h">30 days</option>
                    <option value="2160h">90 days</option>
                    <option value="8760h">1 year</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Create token</button>
        </form>
    </div>
</div>

<!-- Token list -->
{{if .Tokens}}
<div class="overflow-x-auto">
    <table class="table table-zebra w-full">
        <thead>
            <tr>
                <th>Name</th>
                <th>Created</th>
                <th>Last used</th>
                <th>Expires</th>
                <th>Status</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {{range .Tokens}}
            <tr>
                <td class="font-medium">{{.Name}}</td>
                <td>{{.CreatedAt.Format "Jan 2, 2006"}}</td>
                <td>{{if .LastUsedAt.Valid}}{{.LastUsedAt.Time.Format "Jan 2, 2006"}}{{else}}<span class="text-base-content/40">Never</span>{{end}}</td>
                <td>{{if .ExpiresAt.Valid}}{{.ExpiresAt.Time.Format "Jan 2, 2006"}}{{else}}<span class="text-base-content/40">Never</span>{{end}}</td>
                <td>
                    {{if .RevokedAt.Valid}}
                    <span class="badge badge-error badge-sm">Revoked</span>
                    {{else}}
                    <span class="badge badge-success badge-sm">Active</span>
                    {{end}}
                </td>
                <td>
                    {{if not .RevokedAt.Valid}}
                    <button class="btn btn-ghost btn-xs text-error"
                            hx-delete="/dashboard/settings/tokens/{{.ID}}"
                            hx-target="#token-content"
                            hx-swap="innerHTML"
                            hx-confirm="Revoke this token? Any applications using it will stop working.">Revoke</button>
                    {{end}}
                </td>
            </tr>
            {{end}}
        </tbody>
    </table>
</div>
{{else}}
<div class="hero py-16">
    <div class="hero-content text-center">
        <div>
            <h2 class="text-xl font-semibold mb-2">No API tokens</h2>
            <p class="text-base-content/60">Create a token above to start using the API.</p>
        </div>
    </div>
</div>
{{end}}
{{end}}
