{{template "base" .}}

{{define "title"}}Browse Links — Joe Links{{end}}

{{define "content"}}
<!-- Governing: SPEC-0012 REQ "Public Link Browser (GET /links)" -->
<div class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-bold">Public Links</h1>
    <span class="text-sm text-base-content/60">{{.Total}} link{{if ne .Total 1}}s{{end}}</span>
</div>

<!-- Governing: SPEC-0012 REQ "Public Link Search" — search input with HTMX debounce -->
<div class="mb-6">
    <input
        type="search"
        name="q"
        class="input input-bordered w-full"
        placeholder="Search by slug, URL, title, or description..."
        value="{{.Query}}"
        hx-get="/links"
        hx-trigger="input changed delay:300ms, search"
        hx-target="#public-link-list"
        hx-select="#public-link-list"
        hx-swap="outerHTML"
        hx-push-url="true"
    >
</div>

<div id="public-link-list">
{{if .Links}}
<div class="grid gap-4">
    {{range .Links}}
    <div class="card card-compact bg-base-200 shadow-sm">
        <div class="card-body">
            <div class="flex items-start justify-between gap-4">
                <div class="min-w-0 flex-1">
                    <div class="flex items-center gap-2 mb-1">
                        <a href="/{{.Slug}}" class="font-mono font-semibold link link-primary text-lg" target="_blank">{{.Slug}}</a>
                    </div>
                    <p class="text-sm text-base-content/70 truncate mb-1">
                        <a href="{{.URL}}" class="link link-hover" target="_blank">{{.DisplayTitle}}</a>
                    </p>
                    {{if .Description}}
                    <p class="text-sm text-base-content/60 mb-2">{{.TruncatedDescription}}</p>
                    {{end}}
                    <div class="flex flex-wrap items-center gap-2">
                        {{range .Tags}}
                        <span class="badge badge-sm badge-outline">{{.}}</span>
                        {{end}}
                        {{if .OwnerDisplayName}}
                        <!-- Governing: SPEC-0012 REQ "Owner Name Linking in Public Views" -->
                        <span class="text-xs text-base-content/50">
                            by <a href="/u/{{.OwnerSlug}}" class="link link-hover">{{.OwnerDisplayName}}</a>
                        </span>
                        {{end}}
                    </div>
                </div>
                <div class="text-xs text-base-content/50 whitespace-nowrap">
                    {{.CreatedAt.Format "Jan 2, 2006"}}
                </div>
            </div>
        </div>
    </div>
    {{end}}
</div>

<!-- Pagination controls -->
{{if or .HasPrev .HasNext}}
<div class="flex justify-center gap-2 mt-8">
    {{if .HasPrev}}
    <a href="/links?page={{.PrevPage}}{{if .Query}}&q={{.Query}}{{end}}"
       class="btn btn-sm btn-outline">Previous</a>
    {{end}}
    <span class="btn btn-sm btn-disabled">Page {{.Page}} of {{.TotalPages}}</span>
    {{if .HasNext}}
    <a href="/links?page={{.NextPage}}{{if .Query}}&q={{.Query}}{{end}}"
       class="btn btn-sm btn-outline">Next</a>
    {{end}}
</div>
{{end}}

{{else}}
<div class="hero py-16">
    <div class="hero-content text-center">
        <div>
            {{if .Query}}
            <h2 class="text-xl font-semibold mb-2">No links found</h2>
            <p class="text-base-content/60">No public links match your search. Try different keywords.</p>
            {{else}}
            <h2 class="text-xl font-semibold mb-2">No public links yet</h2>
            <p class="text-base-content/60">There are no public links to browse.</p>
            {{end}}
        </div>
    </div>
</div>
{{end}}
</div>
{{end}}
