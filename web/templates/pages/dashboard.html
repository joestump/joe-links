{{template "base" .}}

{{define "title"}}Dashboard — Joe Links{{end}}

{{define "content"}}
<div class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-bold">My Links</h1>
    <!-- Governing: SPEC-0013 REQ "Create/Edit Link Form as HTMX Modal" -->
    <button class="btn btn-primary btn-sm"
            hx-get="/dashboard/links/new"
            hx-target="#modal"
            hx-swap="innerHTML">+ New link</button>
</div>

<!-- Governing: SPEC-0004 REQ "User Dashboard" — search input with HTMX debounce -->
<div class="flex flex-col sm:flex-row gap-3 mb-6">
    <input
        type="search"
        name="q"
        class="input input-bordered flex-1"
        placeholder="Search links by slug, URL, or description..."
        value="{{.Query}}"
        hx-get="/dashboard"
        hx-trigger="input changed delay:400ms, search"
        hx-target="#link-list"
        hx-include="this"
        hx-push-url="false"
    >
</div>

<!-- Governing: SPEC-0010 REQ "Dashboard Visibility Filtering" — My Links / Shared with me tabs -->
<div class="tabs tabs-boxed mb-6 w-fit">
    <a class="tab {{if ne .Filter "shared"}}tab-active{{end}}"
       hx-get="/dashboard"
       hx-target="#link-list"
       hx-push-url="false">My Links</a>
    <a class="tab {{if eq .Filter "shared"}}tab-active{{end}}"
       hx-get="/dashboard?filter=shared"
       hx-target="#link-list"
       hx-push-url="false">Shared with me</a>
</div>

<!-- Governing: SPEC-0004 REQ "User Dashboard" — tag filter chips -->
{{if .Tags}}
<div class="flex flex-wrap gap-2 mb-6">
    <a href="/dashboard"
       class="badge badge-outline {{if not .Tag}}badge-primary{{end}} cursor-pointer"
       hx-get="/dashboard"
       hx-target="#link-list"
       hx-push-url="false">All</a>
    {{range .Tags}}
    <a href="/dashboard?tag={{.Slug}}"
       class="badge badge-outline {{if eq $.Tag .Slug}}badge-primary{{end}} cursor-pointer"
       hx-get="/dashboard?tag={{.Slug}}"
       hx-target="#link-list"
       hx-push-url="false">{{.Name}}</a>
    {{end}}
</div>
{{end}}

<!-- Governing: SPEC-0013 REQ "Create/Edit Link Form as HTMX Modal" — refresh on linkCreated/linkUpdated events -->
<div id="link-list"
     hx-get="/dashboard"
     hx-trigger="linkCreated from:body, linkUpdated from:body"
     hx-target="#link-list"
     hx-swap="innerHTML">
{{template "link_list" .}}
</div>
{{end}}
